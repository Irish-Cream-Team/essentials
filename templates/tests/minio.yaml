{{- if .Values.essentials.outspike.enabled -}}
apiVersion: v1
kind: Pod
metadata:
  name: {{ .Values.essentials.minio.name | default "minio" }}-test
  labels:
    {{- include "master-chart.labels" . | nindent 4 }}
    app: {{ .Values.essentials.minio.name | default "minio" }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: {{ .Values.essentials.minio.name | default "minio" }}-test
      image: "quay.io/minio/minio:latest"
      command:
        - "/bin/sh"
        - "-ce"
        - "/usr/bin/docker-entrypoint.sh minio server /data --address :{{ .Values.essentials.minio.port }} --console-address :{{ .Values.essentials.minio.UIPort }} "
      ports:
        - name: minio
          containerPort: {{ .Values.essentials.minio.port | default "9000"}}
        - name: minio-console
          containerPort: {{ .Values.essentials.minio.UIPort | default "9001"}}
      env:
      - name: MINIO_ROOT_USER
        value: {{ .Values.essentials.minio.rootUser}}
      - name: MINIO_ROOT_PASSWORD
        value: {{ .Values.essentials.minio.rootPassword}}
    
    - name: "minio-mc"
      image: "quay.io/minio/mc:latest"
      env:
      - name: MINIO_ENDPOINT
        value: "minio"
      - name: MINIO_PORT
        value: "9000"
      command:
        - "/bin/sh"
        - "-ce"
        - "minio/mc"
{{- end }}
